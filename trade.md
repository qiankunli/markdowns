## 网站支付方面的一些问题

### 通用系统

在整体设计上

1. 一般要有一个账户系统，存储用户信息及金额。
2. 一个订单系统，存储用户购买记录
3. 通用产品系统。产品，表示可以卖钱的东西，当然，对于该系统，产品的特性无需很多，只需要存储下价格，有效期等通用属性即可。

具体的子系统，再根据通用系统细化，进行自己的设计。

### 统一授权中心

比如用户买了一个声音，那么再进入这个声音的时候，就需要查询用户买了没有（qps很大，就需要缓存等）。系统中有相当多类似的需求，因此搞一个集中的服务出来。

假设用户买了一个会员，而会员是有有效期的，那么你查询用户是否是某个会员的时候，这个需求也要集成到这里来。

### 防止用户重复提交

这个分为不同的场景

1. 用户购买一个声音，那么以uid和trackId作为主键，就可以知道在重复购买时冲突了。
2. 用户购买一个会员，而会员有有效期，这就有不同的策略，比如当天不能重复购买、只能过期后购买等。总之，主键之中要有反应时间的要素。

此外，就是使用两个order。draft order负责记录成功的订单以及一些额外的系统数据，order负责记录成功的订单（失败的订单则会删除）。

## 价格的制定

有的商品是一次性定价（包括折扣价），而有的商品，则是xx/年，这个在设计数据库的时候：价格，折扣价格，时间单位，时间单位值。以每年10元为例：

|价格|折扣价格|时间单位|时间单位值|
|---|---|---|---|
|10|8|1（代表年）|1|





